<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Grant Nguyen" />

<meta name="date" content="2019-09-11" />

<title>assertable Data Assertion Intro</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">assertable Data Assertion Intro</h1>
<h4 class="author"><em>Grant Nguyen</em></h4>
<h4 class="date"><em>2019-09-11</em></h4>



<p>The assertable package contains functions that allow users to easily: * Confirm the number of rows and column names of a dataset * Check the values of given variables (is not NA/infinite, or is less than, equal to, greater than, or contains a given value or set of values) * Check whether the dataset contains all combinations of specified ID variables, and whether it has duplicates within those combinations</p>
<p>This vignette will illustrate how to carry out each of these operations, and to see different ways that assertable can return informative output for informed vetting of tabular data.</p>
<div id="data" class="section level2">
<h2>Data</h2>
<p>We will use the CO2 dataset, which has 64 rows and 5 columns of data from an experiment related to the cold tolerances of plants.</p>
<pre><code>##   Plant   Type  Treatment conc uptake
## 1   Qn1 Quebec nonchilled   95   16.0
## 2   Qn1 Quebec nonchilled  175   30.4
## 3   Qn1 Quebec nonchilled  250   34.8
## 4   Qn1 Quebec nonchilled  350   37.2
## 5   Qn1 Quebec nonchilled  500   35.3
## 6   Qn1 Quebec nonchilled  675   39.2</code></pre>
</div>
<div id="checking-data-structures" class="section level2">
<h2>Checking data structures</h2>
<div id="assert_nrows" class="section level3">
<h3>assert_nrows</h3>
<p>assert_nrows makes sure your dataset is a certain number of rows.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">assert_nrows</span>(CO2,<span class="dv">84</span>)</a></code></pre></div>
<p>[1] “All rows present”</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">assert_nrows</span>(CO2,<span class="dv">80</span>)</a></code></pre></div>
<pre><code>## Error in assert_nrows(CO2, 80): Have 84 rows, expecting 80</code></pre>
</div>
<div id="assert_colnames" class="section level3">
<h3>assert_colnames</h3>
<p>assert_colnames ensures that all column names specified as colnames exist in the dataset, and also that all columns in the dataset exist in the colnames argument.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">assert_colnames</span>(CO2,<span class="kw">c</span>(<span class="st">&quot;Plant&quot;</span>,<span class="st">&quot;Type&quot;</span>,<span class="st">&quot;Treatment&quot;</span>,<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;uptake&quot;</span>))</a></code></pre></div>
<p>[1] “All column names present”</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">assert_colnames</span>(CO2,<span class="kw">c</span>(<span class="st">&quot;Plant&quot;</span>,<span class="st">&quot;Type&quot;</span>,<span class="st">&quot;Treatment&quot;</span>,<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;other_uptake&quot;</span>))</a></code></pre></div>
<pre><code>## Error in assert_colnames(CO2, c(&quot;Plant&quot;, &quot;Type&quot;, &quot;Treatment&quot;, &quot;conc&quot;, : These columns exist in colnames but not in your dataframe: other_uptake and these exist in your dataframe but not in colnames: uptake</code></pre>
<p>If you only want to assert a subset of colnames and allow your dataset to have additional columns besides those specified in colnames, you can use the only_colnames=F option.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">assert_colnames</span>(CO2,<span class="kw">c</span>(<span class="st">&quot;Plant&quot;</span>,<span class="st">&quot;Type&quot;</span>), <span class="dt">only_colnames=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>[1] “All column names present”</p>
</div>
</div>
<div id="checking-column-values" class="section level2">
<h2>Checking column values</h2>
<p>Full list of things it can check for: * not_na: All values must not be NA * not_inf: All values must not be infinite * lt: All values must be less than test_valQ * lte: All values must be less than or equal to test_val * gt: All values must be greater than test_val * gte: All values must be greater than or equal to test_val * equal: All values must be equal to test_val * not_equal: All values must not equal test_val * in: All values must be one of the values in test_val</p>
<div id="na-infinite-etc." class="section level3">
<h3>NA, infinite, etc.</h3>
<p>Here, we can check to see whether any columns of a new dataset, CO2_miss, contain na values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">CO2_miss &lt;-<span class="st"> </span>CO2</a>
<a class="sourceLine" id="cb9-2" title="2">CO2_miss[CO2_miss<span class="op">$</span>Plant <span class="op">==</span><span class="st"> &quot;Qn2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CO2_miss<span class="op">$</span>conc <span class="op">==</span><span class="st"> </span><span class="dv">175</span>, <span class="st">&quot;uptake&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">assert_values</span>(CO2_miss, <span class="dt">colnames=</span><span class="kw">c</span>(<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;uptake&quot;</span>), <span class="dt">test=</span><span class="st">&quot;not_na&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable conc passed not_na test&quot;
##   Plant   Type  Treatment conc uptake
## 9   Qn2 Quebec nonchilled  175     NA</code></pre>
<pre><code>## Error in assert_values(CO2_miss, colnames = c(&quot;conc&quot;, &quot;uptake&quot;), test = &quot;not_na&quot;): 1 Rows for variable uptake are NA in the dataset above</code></pre>
<p>If we run assert_values on the original data, we can check that the dataset is correct.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="kw">c</span>(<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;uptake&quot;</span>), <span class="dt">test=</span><span class="st">&quot;not_na&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable conc passed not_na test&quot;
## [1] &quot;Variable uptake passed not_na test&quot;</code></pre>
<p>Similar functionality exists for checking for infinite values as well, using the not_inf test option.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">CO2_inf &lt;-<span class="st"> </span>CO2</a>
<a class="sourceLine" id="cb14-2" title="2">CO2_inf[CO2_inf<span class="op">$</span>Plant <span class="op">==</span><span class="st"> &quot;Qn2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CO2_inf<span class="op">$</span>conc <span class="op">==</span><span class="st"> </span><span class="dv">175</span>, <span class="st">&quot;uptake&quot;</span>] &lt;-<span class="st"> </span><span class="ot">Inf</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">assert_values</span>(CO2_inf, <span class="dt">colnames=</span><span class="kw">c</span>(<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;uptake&quot;</span>), <span class="dt">test=</span><span class="st">&quot;not_inf&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable conc passed not_inf test&quot;
##   Plant   Type  Treatment conc uptake
## 9   Qn2 Quebec nonchilled  175    Inf</code></pre>
<pre><code>## Error in assert_values(CO2_inf, colnames = c(&quot;conc&quot;, &quot;uptake&quot;), test = &quot;not_inf&quot;): 1 Rows for variable uptake are infinite in the dataset above</code></pre>
</div>
<div id="greaterless-than-contains-equals" class="section level3">
<h3>Greater/less than, contains, equals</h3>
<p>Here, we can see different results for checking values of CO2 against single numeric thresholds.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;gt&quot;</span>, <span class="dv">0</span>) <span class="co"># Are all values greater than 0?</span></a></code></pre></div>
<pre><code>## [1] &quot;Variable uptake passed gt test&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;conc&quot;</span>, <span class="dt">test=</span><span class="st">&quot;lte&quot;</span>, <span class="dv">1000</span>) <span class="co"># Are all values less than/equal to 1000?</span></a></code></pre></div>
<pre><code>## [1] &quot;Variable conc passed lte test&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;lt&quot;</span>, <span class="dv">40</span>) <span class="co"># Are all values less than 40?</span></a></code></pre></div>
<pre><code>##    Plant   Type  Treatment conc uptake
## 11   Qn2 Quebec nonchilled  350   41.8
## 12   Qn2 Quebec nonchilled  500   40.6
## 13   Qn2 Quebec nonchilled  675   41.4
## 14   Qn2 Quebec nonchilled 1000   44.3
## 17   Qn3 Quebec nonchilled  250   40.3
## 18   Qn3 Quebec nonchilled  350   42.1
## 19   Qn3 Quebec nonchilled  500   42.9
## 20   Qn3 Quebec nonchilled  675   43.9
## 21   Qn3 Quebec nonchilled 1000   45.5
## 35   Qc2 Quebec    chilled 1000   42.4
## 42   Qc3 Quebec    chilled 1000   41.4</code></pre>
<pre><code>## Error in assert_values(CO2, colnames = &quot;uptake&quot;, test = &quot;lt&quot;, 40): 11 Rows for variable uptake not less than the test value(s) in the dataset above</code></pre>
<p>Using the “in” option for test, we can assert that the values of the given colnames must contain the values in test_val, which can be a vector of any size.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;Treatment&quot;</span>, <span class="dt">test=</span><span class="st">&quot;in&quot;</span>, <span class="dt">test_val =</span> <span class="kw">c</span>(<span class="st">&quot;nonchilled&quot;</span>,<span class="st">&quot;chilled&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;Variable Treatment passed in test&quot;</code></pre>
<p>We can also test equivalency, to see whether contents are equal or not equal to a given value.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;Type&quot;</span>, <span class="dt">test=</span><span class="st">&quot;not_equal&quot;</span>, <span class="st">&quot;USA&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable Type passed not_equal test&quot;</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">assert_values</span>(CO2[CO2<span class="op">$</span>Type <span class="op">==</span><span class="st"> &quot;Quebec&quot;</span>,], <span class="dt">colnames=</span><span class="st">&quot;Type&quot;</span>, <span class="dt">test=</span><span class="st">&quot;equal&quot;</span>, <span class="st">&quot;Quebec&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable Type passed equal test&quot;</code></pre>
</div>
<div id="vector-comparisons" class="section level3">
<h3>Vector comparisons</h3>
<p>assert_values can also compare your columns against vectors of the same length as the number of rows in your dataset. For example, here we compare the uptake variable against a newly-created new_uptake variable, which is equal to uptake * 2.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">CO2_mult &lt;-<span class="st"> </span>CO2</a>
<a class="sourceLine" id="cb30-2" title="2">CO2_mult<span class="op">$</span>new_uptake &lt;-<span class="st"> </span>CO2_mult<span class="op">$</span>uptake <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb30-3" title="3"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;lt&quot;</span>, CO2_mult<span class="op">$</span>new_uptake)</a></code></pre></div>
<pre><code>## [1] &quot;Variable uptake passed lt test&quot;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;equal&quot;</span>, CO2_mult<span class="op">$</span>new_uptake<span class="op">/</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable uptake passed equal test&quot;</code></pre>
<p>Above, assert_values correctly notes that the uptake = new_uptake / 2. Below, the “gt” assertion fails for a similar reason, while “gte” would have succeeded. Here, we use the display_rows = F option to simply display the row numbers rather than the actual rows that failed this assertion (in this case, it happens to be all the rows).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">CO2_mult &lt;-<span class="st"> </span>CO2</a>
<a class="sourceLine" id="cb34-2" title="2"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;gt&quot;</span>, CO2_mult<span class="op">$</span>new_uptake<span class="op">/</span><span class="dv">2</span>, <span class="dt">display_rows=</span>F)</a></code></pre></div>
<pre><code>## Error in assert_values(CO2, colnames = &quot;uptake&quot;, test = &quot;gt&quot;, CO2_mult$new_uptake/2, : Must specify test_val argument for comparison tests</code></pre>
<p>You can combine assert_values calls to test columns against one another based on arbitrary lower/upper bounds; for example, the code below asserts that all values in the uptake column must be less than the value of conc, and that conc must not be more than 50 times the value of uptake.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">CO2_mult &lt;-<span class="st"> </span>CO2</a>
<a class="sourceLine" id="cb36-2" title="2"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;lt&quot;</span>, CO2_mult<span class="op">$</span>conc, <span class="dt">display_rows=</span>F)</a></code></pre></div>
<pre><code>## [1] &quot;Variable uptake passed lt test&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">assert_values</span>(CO2, <span class="dt">colnames=</span><span class="st">&quot;uptake&quot;</span>, <span class="dt">test=</span><span class="st">&quot;gt&quot;</span>, CO2_mult<span class="op">$</span>conc <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span><span class="dv">50</span>))</a></code></pre></div>
<pre><code>##    Plant        Type Treatment conc uptake
## 77   Mc2 Mississippi   chilled 1000   14.4
## 84   Mc3 Mississippi   chilled 1000   19.9</code></pre>
<pre><code>## Error in assert_values(CO2, colnames = &quot;uptake&quot;, test = &quot;gt&quot;, CO2_mult$conc * : 2 Rows for variable uptake not more than the test value(s) in the dataset above</code></pre>
</div>
<div id="na.rm" class="section level3">
<h3>na.rm</h3>
<p>The na.rm option in assert_values is useful for numeric comparisons – if you try to evaluate a number against a NA value, the output will be returned as NA as well and fail your assertion. By specifying na.rm=T, all NA values are not considered as violating the assertion in assert_values.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">CO2_miss &lt;-<span class="st"> </span>CO2</a>
<a class="sourceLine" id="cb41-2" title="2">CO2_miss[CO2_miss<span class="op">$</span>Plant <span class="op">==</span><span class="st"> &quot;Qn2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CO2_miss<span class="op">$</span>conc <span class="op">==</span><span class="st"> </span><span class="dv">175</span>, <span class="st">&quot;uptake&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw">assert_values</span>(CO2_miss, <span class="dt">colnames=</span><span class="kw">c</span>(<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;uptake&quot;</span>), <span class="dt">test=</span><span class="st">&quot;lt&quot;</span>, <span class="dv">2000</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Variable conc passed lt test&quot;
##   Plant   Type  Treatment conc uptake
## 9   Qn2 Quebec nonchilled  175     NA</code></pre>
<pre><code>## Error in assert_values(CO2_miss, colnames = c(&quot;conc&quot;, &quot;uptake&quot;), test = &quot;lt&quot;, : 1 Rows for variable uptake not less than the test value(s) in the dataset above</code></pre>
<p>With na.rm=T, we can evaluate without marking the NA value for Qn2 as a failure.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">assert_values</span>(CO2_miss, <span class="dt">colnames=</span><span class="kw">c</span>(<span class="st">&quot;conc&quot;</span>,<span class="st">&quot;uptake&quot;</span>), <span class="dt">test=</span><span class="st">&quot;lt&quot;</span>, <span class="dv">2000</span>, <span class="dt">na.rm=</span>T)</a></code></pre></div>
<pre><code>## [1] &quot;Variable conc passed lt test&quot;
## [1] &quot;Variable uptake passed lt test&quot;</code></pre>
</div>
</div>
<div id="checking-for-id-variables" class="section level2">
<h2>Checking for ID variables</h2>
<p>assert_ids allows you to check whether your dataset is “square”, meaning that it contains all unique combinations of ID variables as sepcified in a named list of vectors (e.g. list(id1=c(1,2), id2=c(“A”,B))).</p>
<div id="asserting-unique-combinations-of-id-variables" class="section level3">
<h3>Asserting unique combinations of ID variables</h3>
<p>The ultimate aim is to make sure that you have one row per unique combination of ID variables, and return violations of this rule for easy vetting. Here, we first try to figure out what combinations of variables uniquely identify the data, whether they are missing any combinations of ID variables, and whether there are any duplicates in the data by ID variables. First, we get the levels of some potential ID variables.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">plants &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unique</span>(CO2<span class="op">$</span>Plant))</a>
<a class="sourceLine" id="cb47-2" title="2">treatments &lt;-<span class="st"> </span><span class="kw">unique</span>(CO2<span class="op">$</span>Treatment)</a>
<a class="sourceLine" id="cb47-3" title="3">concs &lt;-<span class="st"> </span><span class="kw">unique</span>(CO2<span class="op">$</span>conc)</a></code></pre></div>
<p>Let’s see if Plant alone is a unique identifier.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>plants)</a>
<a class="sourceLine" id="cb48-2" title="2"><span class="kw">assert_ids</span>(CO2,ids)</a></code></pre></div>
<pre><code>##     Plant n_duplicates
##  1:   Qn1            7
##  2:   Qn2            7
##  3:   Qn3            7
##  4:   Qc1            7
##  5:   Qc2            7
##  6:   Qc3            7
##  7:   Mn1            7
##  8:   Mn2            7
##  9:   Mn3            7
## 10:   Mc1            7
## 11:   Mc2            7
## 12:   Mc3            7</code></pre>
<pre><code>## Error in assert_ids(CO2, ids): These combinations of id variables have n_duplicates duplicate observations per combination (84 total duplicates)</code></pre>
<p>There are 7 duplicates for each plant type because each plant has 7 different values of conc. Now, let’s try adding conc to the ID list.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>plants,<span class="dt">conc=</span>concs)</a>
<a class="sourceLine" id="cb51-2" title="2"><span class="kw">assert_ids</span>(CO2, ids)</a></code></pre></div>
<pre><code>## [1] &quot;Data is identified by id_vars: Plant conc&quot;</code></pre>
<p>Our dataset is uniquely identified by Plant and conc!</p>
</div>
<div id="finding-duplicate-observations-within-combinations-of-id-variables" class="section level3">
<h3>Finding duplicate observations within combinations of ID variables</h3>
<p>Now, let’s see how assert_id returns results when the dataset has duplicate values.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>plants,<span class="dt">conc=</span>concs)</a>
<a class="sourceLine" id="cb53-2" title="2">CO2_dups &lt;-<span class="st"> </span><span class="kw">rbind</span>(CO2,CO2[CO2<span class="op">$</span>Plant<span class="op">==</span><span class="st">&quot;Mc2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CO2<span class="op">$</span>conc <span class="op">&lt;</span><span class="st"> </span><span class="dv">300</span>,])</a>
<a class="sourceLine" id="cb53-3" title="3"><span class="kw">assert_ids</span>(CO2_dups, ids)</a></code></pre></div>
<pre><code>##    Plant conc n_duplicates
## 1:   Mc2   95            2
## 2:   Mc2  175            2
## 3:   Mc2  250            2</code></pre>
<pre><code>## Error in assert_ids(CO2_dups, ids): These combinations of id variables have n_duplicates duplicate observations per combination (6 total duplicates)</code></pre>
<p>Here, we get the unique conbinations of Plant and conc that had duplicate values. If we want a more detailed look at the duplicates, we can specify ids_only = F to return each observation in the original dataset that is a duplicate. This dataset will include the variables n_duplicates (the total number within the combination) and duplicate_id (the observation’s unique ID within the combination).</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>plants,<span class="dt">conc=</span>concs)</a>
<a class="sourceLine" id="cb56-2" title="2"><span class="kw">assert_ids</span>(CO2_dups, ids, <span class="dt">ids_only=</span>F)</a></code></pre></div>
<pre><code>##    Plant conc        Type Treatment uptake n_duplicates duplicate_id
## 1:   Mc2   95 Mississippi   chilled    7.7            2            1
## 2:   Mc2   95 Mississippi   chilled    7.7            2            2
## 3:   Mc2  175 Mississippi   chilled   11.4            2            1
## 4:   Mc2  175 Mississippi   chilled   11.4            2            2
## 5:   Mc2  250 Mississippi   chilled   12.3            2            1
## 6:   Mc2  250 Mississippi   chilled   12.3            2            2</code></pre>
<pre><code>## Error in assert_ids(CO2_dups, ids, ids_only = F): These rows of data are all of the observations with duplicated id_vars, and have n_duplicates duplicate observations per combination of id_varnames (6 total duplicates)</code></pre>
</div>
<div id="additional-assert_id-options" class="section level3">
<h3>Additional assert_id options</h3>
<p>This dataset can also be stored into an object by specifying the warn_only = T option, which can then be saved or used for further exploration.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>plants,<span class="dt">conc=</span>concs)</a>
<a class="sourceLine" id="cb59-2" title="2">dup_rows &lt;-<span class="st"> </span><span class="kw">assert_ids</span>(CO2_dups, ids, <span class="dt">ids_only=</span>F, <span class="dt">warn_only=</span>T)</a></code></pre></div>
<pre><code>## Warning in assert_ids(CO2_dups, ids, ids_only = F, warn_only = T): These
## rows of data are all of the observations with duplicated id_vars, and have
## n_duplicates duplicate observations per combination of id_varnames (6 total
## duplicates)</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">dup_rows</a></code></pre></div>
<p>One behavior of assert_ids is that it stops at the first violation that it reaches. In the example below, the CO2_dups dataset does not contain a certain set of ID combinations and it also has duplicate rows. Since assert_ids first evaluates whether all ID combinations are present, it errors out on the ID combinations part but does not reach the step where it evaluates duplicates.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1"><span class="co">## Add a new fake level to plants, use as.character because the &quot;new_plant&quot; level</span></a>
<a class="sourceLine" id="cb62-2" title="2"><span class="co">## doesn&#39;t mix well with the factor level</span></a>
<a class="sourceLine" id="cb62-3" title="3">new_plants &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.character</span>(plants),<span class="st">&quot;new_plant&quot;</span>)</a>
<a class="sourceLine" id="cb62-4" title="4">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>new_plants,<span class="dt">conc=</span>concs)</a>
<a class="sourceLine" id="cb62-5" title="5">dup_rows &lt;-<span class="st"> </span><span class="kw">assert_ids</span>(CO2_dups, ids)</a></code></pre></div>
<pre><code>##        Plant conc
## 1: new_plant   95
## 2: new_plant  175
## 3: new_plant  250
## 4: new_plant  350
## 5: new_plant  500
## 6: new_plant  675
## 7: new_plant 1000</code></pre>
<pre><code>## Error in assert_ids(CO2_dups, ids): The above combinations of id variables do not exist in your dataset</code></pre>
<p>To evaluate both the existing-combinations and no-duplicate conditions using assert_ids, you can call it twice, with warn_only = T and with alternating toggles on the assert_* options. By capturing the output into objects, you can then output those results separately and then stop execution of your script if neither object is NULL.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">new_plants &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.character</span>(plants),<span class="st">&quot;new_plant&quot;</span>)</a>
<a class="sourceLine" id="cb65-2" title="2">ids &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>new_plants,<span class="dt">conc=</span>concs)</a>
<a class="sourceLine" id="cb65-3" title="3">combos &lt;-<span class="st"> </span><span class="kw">assert_ids</span>(CO2_dups, ids, <span class="dt">assert_dups =</span> F, <span class="dt">warn_only=</span>T)</a></code></pre></div>
<pre><code>## Warning in assert_ids(CO2_dups, ids, assert_dups = F, warn_only = T): The
## following combinations of id variables do not exist in your dataset</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">dup_rows &lt;-<span class="st"> </span><span class="kw">assert_ids</span>(CO2_dups, ids, <span class="dt">assert_combos=</span>F, <span class="dt">ids_only=</span>F, <span class="dt">warn_only=</span>T)</a></code></pre></div>
<pre><code>## Warning in assert_ids(CO2_dups, ids, assert_combos = F, ids_only = F,
## warn_only = T): These rows of data are all of the observations with
## duplicated id_vars, and have n_duplicates duplicate observations per
## combination of id_varnames (6 total duplicates)</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="kw">print</span>(combos)</a></code></pre></div>
<pre><code>##        Plant conc
## 1: new_plant   95
## 2: new_plant  175
## 3: new_plant  250
## 4: new_plant  350
## 5: new_plant  500
## 6: new_plant  675
## 7: new_plant 1000</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1"><span class="kw">print</span>(dup_rows)</a></code></pre></div>
<pre><code>##    Plant conc        Type Treatment uptake n_duplicates duplicate_id
## 1:   Mc2   95 Mississippi   chilled    7.7            2            1
## 2:   Mc2   95 Mississippi   chilled    7.7            2            2
## 3:   Mc2  175 Mississippi   chilled   11.4            2            1
## 4:   Mc2  175 Mississippi   chilled   11.4            2            2
## 5:   Mc2  250 Mississippi   chilled   12.3            2            1
## 6:   Mc2  250 Mississippi   chilled   12.3            2            2</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(combos) <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.null</span>(dup_rows)) <span class="kw">stop</span>(<span class="st">&quot;assert_ids failed, see above for results&quot;</span>)</a></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): assert_ids failed, see above for results</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
